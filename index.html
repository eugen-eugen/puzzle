<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <title>Puzzle Lab</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#222a36" />
  <meta name="description" content="Offline-capable procedural jigsaw puzzle from any image." />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="manifest.json" />
  <link rel="stylesheet" href="css/main.css" />
  <link rel="stylesheet" href="css/piece-box.css" />
  <link rel="stylesheet" href="css/animations.css" />
</head>
<body>
  <header class="top-bar">
    <div class="logo">ðŸ§© Puzzle Lab</div>
    <div class="controls">
      <input id="imageInput" type="file" accept="image/png,image/jpeg" />
      <div class="slider-container">
        <label for="pieceSlider">Pieces:</label>
        <input id="pieceSlider" type="range" min="0" max="100" value="0" />
        <span id="pieceDisplay" class="piece-count">0</span>
      </div>
      <div class="zoom-controls">
        <button id="zoomOutButton" class="zoom-btn" title="Zoom Out">âˆ’</button>
        <span id="zoomDisplay" class="zoom-level">100%</span>
        <button id="zoomInButton" class="zoom-btn" title="Zoom In">+</button>
        <button id="zoomResetButton" class="zoom-reset-btn" title="Reset Zoom">âŒ‚</button>
      </div>
      <button id="checkButton" class="check-btn" style="display:none;">Check! âœ“</button>
      <button id="helpButton" class="help-btn">?</button>
      <span id="progressDisplay" class="progress">0 / 0 (0%)</span>
    </div>
  </header>
  <main class="layout">
    <section id="piecesContainer" class="pieces-container" aria-label="Piece Box">
      <div id="piecesViewport" class="pieces-viewport">
        <div class="placeholder">Load an image and generate puzzle pieces.</div>
      </div>
    </section>
  </main>

  <!-- Help Modal -->
  <div id="helpModal" class="modal" style="display:none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ðŸ§© How to Play Puzzle Lab</h2>
        <span class="close-btn" id="closeHelp">&times;</span>
      </div>
      <div class="modal-body">
        <h3>ðŸŽ¯ Getting Started</h3>
        <ul>
          <li><strong>Upload Image:</strong> Click "Choose File" to select a JPEG or PNG image</li>
          <li><strong>Set Pieces:</strong> Use the slider to choose puzzle size (1-1000 pieces)</li>
          <li><strong>Puzzle generates automatically</strong> as you move the slider</li>
        </ul>

        <h3>ðŸ”§ Playing the Puzzle</h3>
        <ul>
          <li><strong>Drag pieces:</strong> Click and drag to move puzzle pieces around</li>
          <li><strong>Rotate pieces:</strong> Right-click on pieces to rotate them</li>
          <li><strong>Auto-connect:</strong> Pieces snap together automatically when close and aligned</li>
          <li><strong>Group movement:</strong> Connected pieces move together as a group</li>
        </ul>

        <h3>ðŸŽ® Advanced Controls</h3>
        <ul>
          <li><strong>Shift + Drag:</strong> Detach a piece from its group (red outline shows detachment)</li>
          <li><strong>Zoom Controls:</strong> Use +/- buttons, mouse wheel, or keyboard (+, -, 0 to reset)</li>
          <li><strong>Pan View:</strong> Ctrl+drag on empty space or middle-click to move around the puzzle area</li>
          <li><strong>Progress tracking:</strong> Score shows completion based on groups formed</li>
        </ul>

        <h3>âœ… Completion & Validation</h3>
        <ul>
          <li><strong>100% Score:</strong> When all pieces are connected in one group</li>
          <li><strong>Check Button:</strong> Appears at 100% - click to validate puzzle correctness</li>
          <li><strong>Green outlines:</strong> Correctly placed pieces in proper positions and rotation</li>
          <li><strong>Red blinking:</strong> Incorrectly placed pieces (wrong position/rotation)</li>
        </ul>

        <p class="tip"><strong>ðŸ’¡ Tip:</strong> The slider position 0 shows the original image for reference!</p>
      </div>
    </div>
  </div>

  <script type="module" src="js/app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js').catch(err => {
          console.warn('SW registration failed', err);
        });
      });
    }
  </script>
</body>
</html>
